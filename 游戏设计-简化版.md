# 《迷雾森林：月光水晶》简化版

## 一、核心简化原则

**做减法，降低复杂度**
- ❌ 取消：迷雾浓度、时间概念、距离速度、视野系统、随机刷新
- ✅ 保留：回合制移动、固定地图、基础对抗、道具收集

---

## 二、游戏背景（简化版）

玩家闯入森林，需要找到**钥匙**打开密室门，获取**月光水晶**，放到**祭坛**上，然后从**传送门**离开。

---

## 三、角色设定

### 1. 玩家
- **生命值**：100（被攻击 -20/次）
- **物品栏**：最多携带3件道具
- **初始位置**：入口（固定）

### 2. 精灵（阶段2实现）
- **生命值**：50
- **攻击力**：20
- **位置**：密室门前（固定）
- **行为**：玩家到达同一房间时触发战斗

### 3. 守卫者（阶段2实现）
- **生命值**：80
- **攻击力**：15
- **位置**：祭坛房间（固定）
- **行为**：玩家到达同一房间时触发战斗

---

## 四、游戏机制

### 1. 回合制移动
- 玩家输入方向：`north`、`south`、`east`、`west`
- **下回合直接出现在对应房间**（无距离/时间概念）
- 如果该方向没有房间，提示"此路不通"

### 2. 回合制战斗（阶段2实现）
- 玩家与敌人同房间时自动触发战斗
- **回合制互殴**：玩家攻击 → 敌人反击 → 玩家攻击...
- 玩家可选择：
  - `attack`：攻击敌人（基础伤害10）
  - `use bomb`：使用炸弹（伤害40，一次性）
  - `flee`：逃跑到相邻房间（随机方向）

### 3. 道具系统

| 道具名 | 位置（固定） | 效果 | 数量 |
|--------|-------------|------|------|
| 钥匙 | 森林深处 | 打开密室门 | 1 |
| 月光水晶 | 密室内 | 放到祭坛通关 | 1 |
| 炸弹 | 武器库 | 战斗中造成40伤害 | 2 |
| 生命药水 | 药草房 | 恢复生命值至100 | 1 |

---

## 五、胜负条件

### 胜利条件
1. 拿到钥匙
2. 用钥匙打开密室门
3. 拿到月光水晶
4. 把水晶放到祭坛
5. 到达传送门

### 失败条件
- 生命值降到0

---

## 六、地图设计（4×4 网格）

```
[入口] -- [森林小径] -- [森林深处★钥匙] -- [废弃小屋]
  |           |              |                |
[药草房]  [岔路口]    [武器库★炸弹x2]  [密室门🚪]
 ★药水        |              |                |
  |       [水池]        [隐秘通道]        [密室★水晶]
  |           |              |                |
[传送门] -- [祭坛房] -- [仪式前厅] -- [守卫室]
           ★放水晶
```

### 地图说明
- ★ = 固定道具/NPC位置
- 🚪 = 需要钥匙才能通过
- 所有房间都是正交连接（上下左右）
- 玩家固定从**入口**开始

### 地图坐标表示（便于编程）

```
     0        1          2            3
0  入口    森林小径   森林深处      废弃小屋

1  药草房   岔路口     武器库       密室门

2  传送门   水池      隐秘通道      密室

3  传送门   祭坛房    仪式前厅      守卫室
```

### 房间连接关系
```
入口(0,0) -- east --> 森林小径(1,0)
入口(0,0) -- south --> 药草房(0,1)
森林小径(1,0) -- east --> 森林深处(2,0)
森林小径(1,0) -- south --> 岔路口(1,1)
森林深处(2,0) -- east --> 废弃小屋(3,0)
森林深处(2,0) -- south --> 武器库(2,1)
废弃小屋(3,0) -- south --> 密室门(3,1)
药草房(0,1) -- east --> 岔路口(1,1)
药草房(0,1) -- south --> 水池(0,2)
岔路口(1,1) -- east --> 武器库(2,1)
岔路口(1,1) -- south --> 水池(1,2)
武器库(2,1) -- east --> 密室门(3,1)
武器库(2,1) -- south --> 隐秘通道(2,2)
密室门(3,1) -- south --> 密室(3,2)（需要钥匙）
水池(0,2) -- south --> 传送门(0,3)
水池(1,2) -- east --> 隐秘通道(2,2)
水池(1,2) -- south --> 祭坛房(1,3)
隐秘通道(2,2) -- east --> 密室(3,2)
隐秘通道(2,2) -- south --> 仪式前厅(2,3)
密室(3,2) -- south --> 守卫室(3,3)
祭坛房(1,3) -- east --> 仪式前厅(2,3)
仪式前厅(2,3) -- east --> 守卫室(3,3)
```

---

## 七、阶段开发计划

### 阶段1：基础版本（无敌人）✅ 优先实现

**功能清单：**
1. 地图系统
   - 4×4房间网格
   - 房间之间的连接关系
   - 玩家位置追踪

2. 移动系统
   - 接受方向输入（north/south/east/west）
   - 验证移动合法性
   - 更新玩家位置
   - 显示当前房间信息

3. 道具系统
   - 钥匙：拾取后可开门
   - 水晶：拾取后可放到祭坛
   - 炸弹：拾取（战斗用，阶段2使用）
   - 生命药水：拾取（战斗用，阶段2使用）

4. 游戏流程
   ```
   开始 → 移动到森林深处 → 拿钥匙
        → 移动到密室门 → 使用钥匙开门
        → 进入密室 → 拿水晶
        → 移动到祭坛房 → 放水晶
        → 移动到传送门 → 胜利！
   ```

5. 基础命令
   - `look`：查看当前房间
   - `move [direction]`：移动
   - `take [item]`：拾取道具
   - `inventory`：查看背包
   - `use [item]`：使用道具
   - `help`：显示帮助

**阶段1成功标准：**
- 能从入口走到传送门
- 能拾取钥匙并开门
- 能拾取水晶并放到祭坛
- 能显示胜利信息
- **能生成一个可通关的txt文件给老师测试**

---

### 阶段2：添加敌人（后期实现）

**新增功能：**
1. 精灵（密室门前）
   - 玩家到达时触发战斗
   - 回合制攻击

2. 守卫者（祭坛房）
   - 玩家放水晶前触发战斗
   - 回合制攻击

3. 战斗系统
   - 攻击/使用炸弹/逃跑
   - 生命值管理
   - 战斗胜利/失败判定

4. 生命药水功能
   - 恢复生命值

---

## 八、数据结构设计（Prolog实现参考）

### 1. 动态事实
```prolog
% 玩家状态
player_at(0, 0).           % 玩家位置(X, Y)
player_health(100).        % 生命值
has_item(empty).           % 背包（最多3件）

% 道具位置
item_at(key, 2, 0).        % 钥匙在森林深处
item_at(crystal, 3, 2).    % 水晶在密室
item_at(bomb, 2, 1).       % 炸弹1在武器库
item_at(bomb, 2, 1).       % 炸弹2在武器库
item_at(potion, 0, 1).     % 药水在药草房

% 门状态
door_locked(密室门, true).  % 密室门初始上锁

% 祭坛状态
altar_activated(false).     % 祭坛未激活
```

### 2. 静态事实
```prolog
% 房间连接
connected(0, 0, east, 1, 0).   % 入口 -- 森林小径
connected(0, 0, south, 0, 1).  % 入口 -- 药草房
% ... 其他连接

% 房间名称
room_name(0, 0, '入口').
room_name(1, 0, '森林小径').
% ... 其他房间
```

### 3. 核心谓词
```prolog
% 移动
move(Direction) :-
    player_at(X, Y),
    connected(X, Y, Direction, NewX, NewY),
    retract(player_at(X, Y)),
    assert(player_at(NewX, NewY)),
    look.

% 拾取道具
take(Item) :-
    player_at(X, Y),
    item_at(Item, X, Y),
    inventory_not_full,
    retract(item_at(Item, X, Y)),
    assert(has_item(Item)),
    format('你拾取了~w~n', [Item]).

% 使用道具
use(key) :-
    player_at(3, 1),  % 在密室门前
    has_item(key),
    retract(door_locked(密室门, true)),
    assert(door_locked(密室门, false)),
    write('你用钥匙打开了密室门！'), nl.

% 放置水晶
use(crystal) :-
    player_at(1, 3),  % 在祭坛房
    has_item(crystal),
    retract(altar_activated(false)),
    assert(altar_activated(true)),
    write('你将月光水晶放到祭坛上，祭坛开始发光！'), nl.

% 检查胜利
check_win :-
    player_at(0, 3),   % 在传送门
    altar_activated(true),
    write('恭喜！你成功逃离了迷雾森林！'), nl,
    halt.
```

---

## 九、测试用例（可通关流程）

```
开始游戏
> move east          % 入口 → 森林小径
> move east          % 森林小径 → 森林深处
> take key           % 拾取钥匙
> move south         % 森林深处 → 武器库
> take bomb          % 拾取炸弹1
> take bomb          % 拾取炸弹2
> move east          % 武器库 → 密室门
> use key            % 开门
> move south         % 密室门 → 密室
> take crystal       % 拾取水晶
> move south         % 密室 → 守卫室
> move west          % 守卫室 → 仪式前厅
> move west          % 仪式前厅 → 祭坛房
> use crystal        % 放置水晶
> move west          % 祭坛房 → 传送门
胜利！
```

---

## 十、文件输出格式（给老师测试用）

生成 `solution.txt` 文件：
```
move east
move east
take key
move south
take bomb
take bomb
move east
use key
move south
take crystal
move south
move west
move west
use crystal
move west
```

---

## 十一、复杂度对比

| 项目 | 原版 | 简化版 |
|------|------|--------|
| 敌人数量 | 2-5个（动态） | 2个（固定）|
| 地图大小 | 12个房间 | 16个房间 |
| 道具种类 | 5种 | 4种 |
| 时间系统 | ✓ | ✗ |
| 距离系统 | ✓ | ✗ |
| 视野系统 | ✓ | ✗ |
| 迷雾浓度 | ✓ | ✗ |
| 随机刷新 | ✓ | ✗ |
| 敌人AI | 复杂（巡逻/伏击/抢夺） | 简单（固定位置） |
| 战斗系统 | 实时 | 回合制 |

---

## 十二、后期可扩展功能（不在当前范围）

- [ ] 更多敌人类型
- [ ] 更多道具
- [ ] 更大的地图
- [ ] 多个水晶
- [ ] 迷雾机制
- [ ] 特殊效果
- [ ] 随机地图生成

---

**核心理念：先做一个能跑通的最简版本，再逐步迭代！**
